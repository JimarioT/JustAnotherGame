<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
		<link rel="stylesheet" type="text/css" href="css/bootstrap-theme.css">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">		
		<script type="text/javascript" src="js/jquery-2.2.2.js"></script>
		<script type="text/javascript" src="js/bootstrap.js"></script>

		<script type="text/javascript" src="js/campaignInfoObj.js"></script>
		<script type="text/javascript" src="js/resourcesFunctions.js"></script>
		<script type="text/javascript" src="js/saveFunction.js"></script>
		<script type="text/javascript" src="js/buildFunctions.js"></script>
		
		<title>Just a Game</title>

		<style type="text/css">
			.unitCreation {
				margin-top: 10px;
				margin-bottom: 10px;
			}

			.fa-plus {
				margin-left: 5px;
			}

			.fa-minus {
				margin-right: 5px;
			}

			.btnBarracks, .btnHovel, .btnWoodHut, .btnQuarry, .btnFarm {
				margin-top: 10px;
			}

			textarea {
				height: 400px;
			}
		</style>

	</head>
	<body>

		<div class="pgOne" style="display:none;">
			<div class="container">
				<div class="row text-center">
					<div class="col-xs-12">
						<h3 class="text-center">TBA</h3>
						<button class="btn btn-primary btnContinue col-xs-4 col-xs-offset-4">Continue</button>
						<br/>
						<button class="btn btn-primary btnNewCampaign col-xs-4 col-xs-offset-4">New Campaign</button>
						<br/>
						<button class="btn btn-primary btnOptions col-xs-4 col-xs-offset-4">Options</button>
						<br/>
						<button class="btn btn-primary btnExit col-xs-4 col-xs-offset-4">Exit</button>	
					</div>					
				</div>
			</div>
		</div>

		<div class="pgTwo">
			<div class="container">
				<div class="row text-left">
					<div class="col-xs-12">
						<!--<div class="col-md-3">
							<span>Base: </span> <span> A Name </span>
						</div>-->
						<div class="col-xs-12 goldCont">
							<span class="col-xs-1">Gold: </span> <span class="col-xs-2 playersGold"> 0 </span>
						</div>
						<div class="col-xs-12 woodCont">
							<span class="col-xs-1">Wood: </span> <span class="col-xs-2 playersWood"> 0 </span>
							<div class="col-xs-4">
								<i class="fa fa-minus woodMinus" onclick="removeWorkforce('wood')"></i>
								<span class="woodWorkforce"> 0 </span>
								<i class="fa fa-plus woodPlus" onclick="calculateWorkforce('wood')"></i>								
								<span>Working Villager(s)</span>
							</div>
						</div>
						<div class="col-xs-12 stoneCont">
							<span class="col-xs-1">Stone: </span> <span class="col-xs-2 playersStone"> 0 </span>
							<div class="col-xs-4">
								<i class="fa fa-minus stoneMinus" onclick="removeWorkforce('stone')"></i>
								<span class="stoneWorkforce"> 0 </span>
								<i class="fa fa-plus stonePlus" onclick="calculateWorkforce('stone')"></i>								
								<span>Working Villager(s)</span>
							</div>							
						</div>
						<div class="col-xs-12 foodCont">
							<span class="col-xs-1">Food: </span> <span class="col-xs-2 playersFood"> 0 </span>	
							<div class="col-xs-4">
								<i class="fa fa-minus foodMinus" onclick="removeWorkforce('food')"></i>
								<span class="foodWorkforce"> 0 </span>
								<i class="fa fa-plus foodPlus" onclick="calculateWorkforce('food')"></i>								
								<span>Working Villager(s)</span>
							</div>
						</div>
						<div class="col-xs-12">
							<span class="col-xs-1">Villagers: </span> <span class="col-xs-2 playersVillagers"> 0 </span>	
						</div>
						<div class="col-xs-4">
							<div class="row hovelList">
								
							</div>
						</div>
						<div class="col-xs-5 col-xs-offset-7">
							<textarea class="col-xs-10 col-xs-offset-1"></textarea>
						</div>
						
						<div class="col-xs-12">
							<div class="col-xs-4 unitCreation">
								<button class="btnBarracks" style="display: none;"> Create Some Troops </button>
							</div>
						</div>
						<div style="display: none;">
							<button onclick="saveSession()">Save Game</button>
							<input id="fileToLoad" type="file" />
							<button onclick="loadSession()">Load Game</button>	
						</div>
						

						<div class="row">
							<div class="col-xs-6">
								<button class="btn" data-toggle="modal" data-target="#buildingModal">Create Building</button>
							</div>
							<div class="col-xs-6"></div>
						</div>
					</div>					
				</div>
			</div>
		</div>

		<div class="modal fade" id="buildingModal" role="dialog">
    		<div class="modal-dialog">
    
	      		<!-- Modal content-->
	      		<div class="modal-content">
	        		<div class="modal-header">
	          			<button type="button" class="close" data-dismiss="modal">&times;</button>
	          			<h4 class="modal-title">Modal Header</h4>
	        		</div>
		        	<div class="modal-body">
		          		<p>Select a build from the list</p>
		      			<button class="btn btnBarracks" data-dismiss="modal" onclick="createBuilding('barracks')"></button>
		      			<button class="btn btnHovel" data-dismiss="modal" onclick="createBuilding('hovels')"></button>
		      			<button class="btn btnWoodHut" data-dismiss="modal" onclick="createBuilding('woodHuts')"></button>
		      			<button class="btn btnQuarry" data-dismiss="modal" onclick="createBuilding('quarry')"></button>
		      			<button class="btn btnFarm" data-dismiss="modal" onclick="createBuilding('farms')"></button>
		        	</div>
		        	<div class="modal-footer">
		        	  	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
		        	</div>
		        </div>
		    </div>
      	</div>
      
   

		<script type="text/javascript">		
			var intervalCarrier;
			var boredText = "";
			var buildingProdMod = 0;

			var woodProdMod = 0;
			var quarryProdMod = 0;
			var farmProdMod = 0;

			var boredVillagers = [
				"*Hey boss, it's a tad boring over here! Let me help!*",
				"*It's nice, not doing anything! But how will I pay my taxes with no job?*",
				"*Psit ... Boss ... Hey ... You forgot about me?*",
				"**Singing in the rain Tune* ... I'm scraaatching over here!*",
				"*We need to add a WiFi antenna for when we are doing NOTHING*",
				"It's a nice day today, for not doing anything"
			];

			var resources = {
				'gold' : 0 ,
				'wood': 0 ,
				'stone': 0,
				'food': 0,
				'villagers': 6
			};

			

			var loadedSession = '';

			function calculateWorkforce(job, a) {

				var workforce = parseFloat($('.woodWorkforce').text()) + parseFloat($('.stoneWorkforce').text()) + parseFloat($('.foodWorkforce').text());
				
				if($('div[data-building="WoodHut0"]').length > 0) {					
					workforce = workforce + parseFloat($('div[data-building="WoodHut0"]').attr('data-workers'));					
				}

				if($('div[data-building="Quarry0"]').length > 0) {					
					workforce = workforce + parseFloat($('div[data-building="Quarry0"]').attr('data-workers'));					
				}

				if($('div[data-building="Farm0"]').length > 0) {					
					workforce = workforce + parseFloat($('div[data-building="Farm0"]').attr('data-workers'));					
				}


				/*if(job == "woodCutter") {
					var test = campaignInfo.baseInfo.buildings.woodHuts.buildingInfo.builtStatus;
					if(test.length > 0) {
						for (var i =0; i < test.length; i++) {
							workforce = workforce + test[i].currentlyWorking;
						}
					}
				}
				
				if(job == "stoneCutter") {
					var test = campaignInfo.baseInfo.buildings.quarry.buildingInfo.builtStatus;
					if(test.length > 0) {
						for (var i =0; i < test.length; i++) {
							workforce = workforce + test[i].currentlyWorking;
						}
					}
				}
				
				if(job == "farmer") {
					console.log('1');
					var test = campaignInfo.baseInfo.buildings.farms.buildingInfo.builtStatus;					
					if(test.length > 0) {
						for (var i =0; i < test.length; i++) {
							workforce = workforce + test[i].currentlyWorking;
						}
					}
				}*/				

				if (workforce < resources.villagers) {
					addWorkforce(job, a);
				}				
			}

			function addWorkforce(job, a) {	
				var workforce;
				if (job == 'wood') {					
					workforce = $('.woodWorkforce').text();					
					workforce ++;					
					$('.woodWorkforce').text(workforce);
				}
				if (job == 'stone') {
					workforce = $('.stoneWorkforce').text();					
					workforce ++;
					$('.stoneWorkforce').text(workforce);
				}
				if (job == 'food') {
					workforce = $('.foodWorkforce').text();					
					workforce ++;
					$('.foodWorkforce').text(workforce);
				}
				if (job == 'woodCutter') {
					var woodCutterWorkers = $(a).parent().attr('data-workers');
					var maxAllowed = $(a).parent().attr('data-maxworkers');					
					if(woodCutterWorkers < maxAllowed) {
						$(a).parent().attr('data-workers', parseFloat(woodCutterWorkers) + 1);
					}					
					//workforce = $('.woodCutterWorkforce').text();					
					//workforce ++;
					woodCutterWorkers = $(a).parent().attr('data-workers');
					$('.woodCutterWorkforce').text(woodCutterWorkers);
				}
				if (job == 'stoneCutter') {
					var stoneCutterWorkers = $(a).parent().attr('data-workers');					
					var maxAllowed = $(a).parent().attr('data-maxworkers');					
					if(stoneCutterWorkers < maxAllowed) {
						$(a).parent().attr('data-workers', parseFloat(stoneCutterWorkers) + 1);
					}
					
					//workforce = $('.stoneCutterWorkforce').text();					
					//workforce ++;
					stoneCutterWorkers = $(a).parent().attr('data-workers');
					$('.stoneCutterWorkforce').text(stoneCutterWorkers);
				}
				if (job == 'farmer') {
					var farmers = $(a).parent().attr('data-workers');
					var maxAllowed = $(a).parent().attr('data-maxworkers');	
					if(farmers < maxAllowed) {
						$(a).parent().attr('data-workers', parseFloat(farmers) + 1);
					}									
					//workforce = $('.farmerWorkforce').text();
					//workforce ++;
					farmers = $(a).parent().attr('data-workers');
					$('.farmerWorkforce').text(farmers);
				}

				clearInterval(intervalCarrier);
				generateResources();
			}

			function removeWorkforce(job, a) {
				var workforce;
				if (job == 'wood') {
					workforce = $('.woodWorkforce').text();
					if(workforce > 0) {
						workforce --;
						$('.woodWorkforce').text(workforce);
					}
				}
				if (job == 'stone') {
					workforce = $('.stoneWorkforce').text();
					if(workforce > 0) {
						workforce --;
						$('.stoneWorkforce').text(workforce);
					}					
				}
				if (job == 'food') {
					workforce = $('.foodWorkforce').text();
					if(workforce > 0) {
						workforce --;
						$('.foodWorkforce').text(workforce);
					}					
				}
				if (job == 'woodCutter') {
					workforce = $('.woodCutterWorkforce').text();
					if(workforce > 0) {
						workforce --;
						$('.woodCutterWorkforce').text(workforce);
					}
				}
				if (job == 'stoneCutter') {
					workforce = $('.stoneCutterWorkforce').text();
					if(workforce > 0) {
						workforce --;
						var stoneCutterWorkers = $(a).parent().attr('data-workers');
						if(stoneCutterWorkers > 0) {
							$(a).parent().attr('data-workers', parseFloat(stoneCutterWorkers) - 1);
						}
						$('.stoneCutterWorkforce').text(workforce);
					}					
				}
				if (job == 'farmer') {
					workforce = $('.farmerWorkforce').text();
					if(workforce > 0) {
						workforce --;
						var farmers = $(a).parent().attr('data-workers');
						if(farmers > 0) {
							$(a).parent().attr('data-workers', parseFloat(farmers) - 1);
						}
					}
					$('.farmerWorkforce').text(workforce)
				}
				clearInterval(intervalCarrier);
				generateResources();
			}

			function villagersFeedback() {				
				var repeats = 0;
				
				setInterval(function() {
					var workforce = parseFloat($('.woodWorkforce').text()) + parseFloat($('.stoneWorkforce').text()) + parseFloat($('.foodWorkforce').text());

					if($('div[data-building="WoodHut0"]').length > 0) {					
						workforce = workforce + parseFloat($('div[data-building="WoodHut0"]').attr('data-workers'));					
					}

					if($('div[data-building="Quarry0"]').length > 0) {					
						workforce = workforce + parseFloat($('div[data-building="Quarry0"]').attr('data-workers'));					
					}

					if($('div[data-building="Farm0"]').length > 0) {					
						workforce = workforce + parseFloat($('div[data-building="Farm0"]').attr('data-workers'));					
					}

					if(workforce < resources.villagers) {
						var boredCase = Math.floor(((Math.random() * 10) + 1) / 2);						
						boredText = boredText + boredVillagers[boredCase] + '\n';
						$('textarea').val(boredText);
						repeats ++;						
					}
					else if (workforce == resources.villagers){
						var emptyString = "";
						$('textarea').val(emptyString);
					}
					if(repeats == 10) {
						boredText = "";
						$('textarea').val(boredText);
						repeats = 0;
					}
				}, 10000);				
			}

			$(document).ready(function() {
				//navigator.webkitPersistentStorage.requestQuota(1024*1024, function() {
 				//	window.webkitRequestFileSystem(window.PERSISTENT , 1024*1024, SaveDatFileBro);
				//});

				generateResources();
				villagersFeedback();
				showBuildingCosts();
			});
		</script>
	</body>
</html>